"use strict";angular.module("autoPlaylistApp",["ngRoute","ngTouch","angularSlideables","lastfm","youtube","youtube-embed"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode=!0}]),angular.module("autoPlaylistApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("autoPlaylistApp").controller("MainCtrl",["$scope","$interval","videoIdService",function(a,b,c){a.artistVideoId=!1,a.trackVideoId=!1,a.trackPlayerId="trackplayer",a.artistPlayerId="artistplayer",a.trackPlayer={},a.artistPlayer={},a.setVideoId=function(b,e){var f=d(b);c(f).then(function(b){a[e+"VideoId"]=b.videoId})};var d=function(b){a.trackdetails={},b.artist?(a.trackdetails.artist=b.artist.name,a.trackdetails.track=b.name):a.trackdetails.artist=b.name;var c=a.trackdetails.artist;return a.trackdetails.track&&(c=c+" "+a.trackdetails.track),a.trackdetails.searchTerm=c,c};a.pauseArtistPlayer=function(){console.log("pausing artist player"),"undefined"!=typeof a.artistPlayer.pauseVideo&&a.artistPlayer.pauseVideo()},a.playArtistPlayer=function(){console.log("play artist player"),"undefined"!=typeof a.artistPlayer.playVideo&&a.artistPlayer.playVideo()},a.pauseTrackPlayer=function(){console.log("pausing track player"),"undefined"!=typeof a.trackPlayer.pauseVideo&&a.trackPlayer.pauseVideo()},a.playTrackPlayer=function(){console.log("play track player"),"undefined"!=typeof a.trackPlayer.playVideo&&a.trackPlayer.playVideo()}}]),angular.module("lastfm",[]).directive("lastfmArtists",["$http",function(a){var b={restrict:"A",scope:"=",link:function(b,c,d){var e=d.limit||"12",f=d.period||"1month";a.jsonp("http://ws.audioscrobbler.com/2.0/?method=user.gettopartists&limit="+e+"&period="+f+"&user="+d.lastfmArtists+"&api_key="+d.key+"&format=json&callback=JSON_CALLBACK").success(function(a){b.artists=a})},templateUrl:"views/templates/artists.html"};return b}]).directive("lastfmTracks",["$http",function(a){var b={restrict:"A",scope:"=",link:function(b,c,d){var e=d.limit||"12",f=d.period||"1month";a.jsonp("http://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&limit="+e+"&period="+f+"&user="+d.lastfmTracks+"&api_key="+d.key+"&format=json&callback=JSON_CALLBACK").success(function(a){b.tracks=a})},templateUrl:"views/templates/tracks.html"};return b}]),angular.module("angularSlideables",[]).directive("slideable",function(){return{restrict:"C",scope:{onOpen:"@",onClose:"@"},compile:function(a){var b=a.html();return a.html('<div class="slideable_content" style="margin:0 !important; padding:0 !important" >'+b+"</div>"),function(a,b,c){c.duration=c.duration?c.duration:"1s",c.easing=c.easing?c.easing:"ease-in-out",b.css({overflow:"hidden",height:"0px",transitionProperty:"height",transitionDuration:c.duration,transitionTimingFunction:c.easing})}}}}).directive("slideToggle",["$rootScope",function(a){var b=function(a){a.style.height="0px",window.el=a,console.log("removeClass",a);var b=$(a).prev(".row.expanded");b.removeClass("expanded"),b.find("a.selected").removeClass("selected")},c=function(c){$(".slideable").each(function(d,e){e!==c[0]&&(b(e),a.$emit("close"))})};return{restrict:"A",scope:{onOpen:"=",onClose:"="},link:function(b,d,e){var f,g;e.expanded=!1;var h=$(d),i=h.parents(".row");d.bind("click",function(){f||(f=document.querySelector(e.slideToggle)),g||(g=f.querySelector(".slideable_content")),i.hasClass("expanded")?h.hasClass("selected")?(i.removeClass("expanded"),h.removeClass("selected"),console.log("calling on close"),b.onClose(),f.style.height="0px"):h.addClass("selected"):(c($(f)),g.style.border=0,f.style.height="390px",i.addClass("expanded"),h.addClass("selected"),console.log("calling on open"),b.onOpen()),a.$on("close",function(){b.onClose()})})}}}]),angular.module("youtube-embed",["ng"]).service("youtubeEmbedUtils",["$window","$rootScope",function(a,b){function c(a,b){return a.indexOf(b)>-1}var d={},e=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,f=/t=(\d+)[ms]?(\d+)?s?/;return d.getIdFromURL=function(a){var b=a.replace(e,"$1");if(c(b,";")){var d=b.split(";");if(c(d[1],"%")){var f=decodeURIComponent(b.split(";")[1]);b=("http://youtube.com"+f).replace(e,"$1")}else b=d[0]}else c(b,"#")&&(b=b.split("#")[0]);return b},d.getTimeFromURL=function(a){a=a||"";var b=a.match(f);if(!b)return 0;var d=b[0],e=b[1],g=b[2];return"undefined"!=typeof g?(g=parseInt(g,10),e=parseInt(e,10)):c(d,"m")?(e=parseInt(e,10),g=0):(g=parseInt(e,10),e=0),g+60*e},function(){var a=["http:","https:"],b="//www.youtube.com/iframe_api";a.indexOf(window.location.protocol)<0&&(b="http:"+b);var c=document.createElement("script");c.src=b;var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}(),d.ready=!1,a.onYouTubeIframeAPIReady=function(){b.$apply(function(){d.ready=!0})},d}]).directive("youtubeVideo",["youtubeEmbedUtils",function(a){var b=1,c={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},d="youtube.player.";return{templateUrl:"views/templates/youtube.html",restrict:"EA",scope:{videoId:"=?",videoUrl:"=?",player:"=?",playerVars:"=?",playerHeight:"=?",playerWidth:"=?"},link:function(e,f,g){function h(){var a=[].slice.call(arguments);e.$apply(function(){e.$emit.apply(e,a)})}function i(a){var b=c[a.data];"undefined"!=typeof b&&h(d+b,e.player,a),e.$apply(function(){e.player.currentState=b})}function j(a){h(d+"ready",e.player,a)}function k(){var a=angular.copy(e.playerVars);a.autoplay=1,a.start=a.start||e.urlStartTime;var b=new YT.Player(m,{height:e.playerHeight,width:e.playerWidth,videoId:e.videoId,playerVars:a,events:{onReady:j,onStateChange:i}});return b.id=m,b}function l(){m&&e.videoId&&(e.player&&e.player.d&&"function"==typeof e.player.destroy&&e.player.destroy(),e.player=k())}e.utils=a;var m=g.playerId||f[0].id||"unique-youtube-embed-id-"+b++;f[0].id=m,e.playerHeight=e.playerHeight||390,e.playerWidth=e.playerWidth||640,e.playerVars=e.playerVars||{};var n=e.$watch(function(){return e.utils.ready&&("undefined"!=typeof e.videoUrl||"undefined"!=typeof e.videoId)},function(a){a&&(n(),"undefined"!=typeof e.videoUrl?e.$watch("videoUrl",function(a){e.videoId=e.utils.getIdFromURL(a),e.urlStartTime=e.utils.getTimeFromURL(a),l()}):e.$watch("videoId",function(){e.urlStartTime=null,l()}))});e.$on("$destroy",function(){e.player&&e.player.destroy()})}}}]);var myApp=angular.module("youtube",[]);myApp.constant("YT_event",{STOP:0,PLAY:1,PAUSE:2,STATUS_CHANGE:3}),myApp.directive("youtube",["$window","YT_event","$http",function(a,b,c){return{restrict:"E",scope:{height:"@",width:"@",searchTerm:"@",type:"@",potato:"=",trackdetails:"=trackdetails",youtubecontrols:"=",playerready:"="},templateUrl:"views/templates/youtube.html",link:function(d,e,f){d.type=f.type,console.log(d.type);var g,h="AIzaSyAXaCYfu1UnCYX2VMcsu-KOTn4QJJ_SGEM";if(d.youtubecontrols.pause=function(){"undefined"!=typeof g&&g.pauseVideo()},d.youtubecontrols.play=function(){"undefined"==typeof g||YT.PlayerState.PLAYING||g.playVideo()},d.$watch(function(){return d.trackdetails.artist},function(){d.trackdetails.artist&&k()}),d.$watch(function(){return d.playerReady},function(){console.log(e),d.playerReady&&YT&&(console.log(e.find(".youtubePlayer")),g=new YT.Player(e.find(".youtubePlayer")[0],{playerVars:{html5:1,theme:"light",modesbranding:0,color:"white",autoplay:0,iv_load_policy:3,showinfo:1,controls:1,key:h},height:d.height,width:d.width,events:{onReady:function(){console.log("ready!"),g.loadVideoById(d.videoid)},onStateChange:function(a){var c={event:b.STATUS_CHANGE,data:""};switch(a.data){case YT.PlayerState.PLAYING:c.data="PLAYING";break;case YT.PlayerState.ENDED:c.data="ENDED";break;case YT.PlayerState.UNSTARTED:c.data="NOT PLAYING";break;case YT.PlayerState.PAUSED:c.data="PAUSED"}d.$apply(function(){d.$emit(c.event,c.data)})}}}))}),!window.yt){var i=document.createElement("script");i.src="https://www.youtube.com/iframe_api";var j=document.getElementsByTagName("script")[0];"https://www.youtube.com/iframe_api"!==j.src&&j.parentNode.insertBefore(i,j)}var k=function(){console.log(d.trackdetails.searchTerm),c.get("https://www.googleapis.com/youtube/v3/search",{params:{key:h,type:"video",maxResults:"1",part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default,items/snippet/channelTitle",q:d.trackdetails.searchTerm||"neil young alabama"}}).success(function(a){d.videoid=a.items[0].id.videoId,d.trackdetails.fullTitle=a.items[0].snippet.title})};a.onYouTubeIframeAPIReady=function(){d.playerReady=!0},d.$watch("height + width",function(a,b){a!=b&&g.setSize(d.width,d.height)}),d.$watch("videoid",function(a,b){"undefined"!=typeof g&&d.videoid&&g.loadVideoById(d.videoid)}),d.$on(b.STOP,function(){g.seekTo(0),g.stopVideo()}),d.$on(b.PLAY,function(){g.playVideo()}),d.$on(b.PAUSE,function(){g.pauseVideo()})}}}]),angular.module("autoPlaylistApp").factory("videoIdService",["$http",function(a){var b=function(b){var c="AIzaSyAXaCYfu1UnCYX2VMcsu-KOTn4QJJ_SGEM";return a.get("https://www.googleapis.com/youtube/v3/search",{params:{key:c,type:"video",maxResults:"1",part:"id,snippet",fields:"items/id,items/snippet/title,items/snippet/description,items/snippet/thumbnails/default,items/snippet/channelTitle",q:b||"neil young alabama"}}).then(function(a){var b=a.data.items[0].id.videoId,c=a.data.items[0].snippet.title;return{videoId:b,fullTitle:c}})};return b}]);